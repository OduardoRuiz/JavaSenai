package objetos.gui.resposta.ex03.view;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

import javax.swing.GroupLayout;
import javax.swing.GroupLayout.Alignment;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.LayoutStyle.ComponentPlacement;
import javax.swing.border.EmptyBorder;
import javax.swing.border.TitledBorder;

import objetos.gui.resposta.ex03.model.Endereco;
import objetos.gui.resposta.ex03.model.Fornecedor;
import objetos.gui.resposta.ex03.model.Produto;
import objetos.gui.resposta.ex03.view.adapter.ProdutoAdapter;

@SuppressWarnings("serial")
public class CadFornecedor extends JFrame implements ActionListener {
	private JPanel contentPane;
	private JLabel lblNome;
	private JTextField tfNome;
	private JLabel lblEnd;
	private JButton btEndereco;
	private JPanel panel;
	private JButton btAdiciona;
	private JButton btExclui;
	private JScrollPane scrollPane;
	private JTable table;
	private JButton btSalvar;
	private JButton btListar;
	private JButton btFechar;
	
	private List<Fornecedor> cadastro = new ArrayList<>();
	private List<Produto> produtos = new ArrayList<>();
	private ProdutoAdapter model = new ProdutoAdapter(produtos);
	private Endereco endereco = new Endereco();

	public CadFornecedor() {
		setTitle("Cadastro de Fornecedores");
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setBounds(100, 100, 458, 400);
		contentPane = new JPanel();
		contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));
		setContentPane(contentPane);
		
		lblNome = new JLabel("Nome");
		
		tfNome = new JTextField();
		tfNome.setColumns(10);
		
		lblEnd = new JLabel("End.");
		
		btEndereco = new JButton("...");
		btEndereco.addActionListener(this);
		btEndereco.setToolTipText("Abre o Diálogo de cadastro de Entedeço");
		
		panel = new JPanel();
		panel.setBorder(new TitledBorder(null, "Produtos", TitledBorder.LEADING, TitledBorder.TOP, null, null));
		
		btSalvar = new JButton("Salvar");
		btSalvar.addActionListener(this);
		
		btFechar = new JButton("Fechar");
		btFechar.addActionListener(this);
		
		btListar = new JButton("Listar");
		btListar.addActionListener(this);
		GroupLayout gl_contentPane = new GroupLayout(contentPane);
		gl_contentPane.setHorizontalGroup(
			gl_contentPane.createParallelGroup(Alignment.TRAILING)
				.addGroup(gl_contentPane.createSequentialGroup()
					.addContainerGap()
					.addGroup(gl_contentPane.createParallelGroup(Alignment.TRAILING)
						.addGroup(gl_contentPane.createSequentialGroup()
							.addGroup(gl_contentPane.createParallelGroup(Alignment.LEADING)
								.addComponent(lblEnd)
								.addComponent(lblNome))
							.addGap(18)
							.addGroup(gl_contentPane.createParallelGroup(Alignment.LEADING)
								.addComponent(btEndereco)
								.addComponent(tfNome, GroupLayout.DEFAULT_SIZE, 381, Short.MAX_VALUE)))
						.addGroup(gl_contentPane.createParallelGroup(Alignment.LEADING, false)
							.addGroup(gl_contentPane.createSequentialGroup()
								.addComponent(btSalvar)
								.addPreferredGap(ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
								.addComponent(btListar)
								.addGap(90)
								.addComponent(btFechar))
							.addComponent(panel, GroupLayout.PREFERRED_SIZE, 432, GroupLayout.PREFERRED_SIZE)))
					.addContainerGap())
		);
		gl_contentPane.setVerticalGroup(
			gl_contentPane.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_contentPane.createSequentialGroup()
					.addContainerGap()
					.addGroup(gl_contentPane.createParallelGroup(Alignment.BASELINE)
						.addComponent(tfNome, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
						.addComponent(lblNome))
					.addPreferredGap(ComponentPlacement.UNRELATED)
					.addGroup(gl_contentPane.createParallelGroup(Alignment.BASELINE)
						.addComponent(btEndereco)
						.addComponent(lblEnd))
					.addPreferredGap(ComponentPlacement.RELATED)
					.addComponent(panel, GroupLayout.PREFERRED_SIZE, 230, GroupLayout.PREFERRED_SIZE)
					.addGap(18)
					.addGroup(gl_contentPane.createParallelGroup(Alignment.BASELINE)
						.addComponent(btSalvar)
						.addComponent(btFechar)
						.addComponent(btListar))
					.addContainerGap(12, Short.MAX_VALUE))
		);
		
		btAdiciona = new JButton("+");
		btAdiciona.setToolTipText("Incluir Produto");
		btAdiciona.addActionListener(this);
		
		btExclui = new JButton("-");
		btExclui.setToolTipText("Excluir Produto");
		btExclui.addActionListener(this);
		
		scrollPane = new JScrollPane();
		GroupLayout gl_panel = new GroupLayout(panel);
		gl_panel.setHorizontalGroup(
			gl_panel.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_panel.createSequentialGroup()
					.addContainerGap()
					.addGroup(gl_panel.createParallelGroup(Alignment.LEADING)
						.addComponent(scrollPane, GroupLayout.PREFERRED_SIZE, 406, GroupLayout.PREFERRED_SIZE)
						.addGroup(gl_panel.createSequentialGroup()
							.addComponent(btAdiciona, GroupLayout.PREFERRED_SIZE, 39, GroupLayout.PREFERRED_SIZE)
							.addPreferredGap(ComponentPlacement.RELATED)
							.addComponent(btExclui, GroupLayout.PREFERRED_SIZE, 39, GroupLayout.PREFERRED_SIZE)))
					.addContainerGap(8, Short.MAX_VALUE))
		);
		gl_panel.setVerticalGroup(
			gl_panel.createParallelGroup(Alignment.LEADING)
				.addGroup(gl_panel.createSequentialGroup()
					.addContainerGap()
					.addComponent(scrollPane, GroupLayout.PREFERRED_SIZE, 154, GroupLayout.PREFERRED_SIZE)
					.addPreferredGap(ComponentPlacement.RELATED, 11, Short.MAX_VALUE)
					.addGroup(gl_panel.createParallelGroup(Alignment.BASELINE)
						.addComponent(btAdiciona)
						.addComponent(btExclui))
					.addContainerGap())
		);

		table = new JTable();
		table.setModel(model);
		table.setAutoCreateRowSorter(true);
		scrollPane.setViewportView(table);
		panel.setLayout(gl_panel);
		contentPane.setLayout(gl_contentPane);
		
		getRootPane().setDefaultButton(btSalvar);
		setLocationRelativeTo(null);
	}
	
	public void actionPerformed(ActionEvent evento) {
		Object botao = evento.getSource();
		
		if(botao.equals(btEndereco)) {
			CadEndereco dialog = new CadEndereco(endereco);
			dialog.setLocationRelativeTo(this);
			dialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
			dialog.setVisible(true);			
		} else if(botao.equals(btAdiciona)) {
			CadProduto dialog = new CadProduto();
			dialog.setLocationRelativeTo(this);
			dialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
			dialog.setVisible(true);
			
			Produto produto = dialog.getProduto();
			if(produto != null) {
				model.adicionar(produto);
			}
		} else if(botao.equals(btExclui)) {
			int linha = table.getSelectedRow();
			if(linha > -1) {
				if(table.getRowSorter() != null) {
					linha = table.getRowSorter().convertRowIndexToModel(linha);
				}
				model.excluir(linha);
			} else {
				JOptionPane.showMessageDialog(this, "Selecione um Produto para ser excluido!");
			}
		} else if(botao.equals(btSalvar)) {
			Fornecedor fornecedor = new Fornecedor();
			fornecedor.setNome(tfNome.getText());
			fornecedor.setEndereco(endereco);
			fornecedor.setProdutos(produtos);
			produtos.stream().forEach((p) -> p.setFornecedor(fornecedor));
			
			cadastro.add(fornecedor);
			
			tfNome.setText("");
			endereco = new Endereco();
			produtos = new ArrayList<>();
			model.setProdutos(produtos);
			tfNome.requestFocus();
		} else if(botao.equals(btListar)) {
			JOptionPane.showMessageDialog(this, 
					"Cadastro de Fornecedores\n\n" + 
					cadastro.stream()
						.map((f) -> f.toString())
						.collect(Collectors.joining("\n")));
		} else {
			System.exit(0);
		}
	}
}
